# Get SSL Certificates

- Status: Code tested and working as of 2019-10-11

## What

This function compute code (in Python 3) demonstrates how to generate SSL certificates using [Let's Encrypt](https://letsencrypt.org/), then bind them to an Alibaba Cloud [OSS](https://www.alibabacloud.com/product/oss) bucket.

Because Let's Encrypt certificates expire every 90 days, this code gives you a convenient way to create a scheduled task (in the form of a Function Compute function) that can auto-renew your certificates on a regular schedule, without the need to spin up an [ECS](https://www.alibabacloud.com/product/oss) instance.

## Let's Encrypt, certbot, and "challenges"

Let's Encrypt provides a tool called `certbot` which can automatically perform a *challenge* to confirm your ownership of a domain, then issue and install an SSL certificate for you. 

Unfortunately, there is currently no plugin to automate the challenge and install procedure for sites hosted on OSS, so it's necessary to use certbot's **manual** plugin.

The **manual** plugin supports two types of challenges:

- DNS
- HTTP

The DNS challenge requires you to modify your domain's DNS settings to include a specific TXT record generated by certbot. 

The HTTP challenge requires you to place a file generated by certbot under `/.well-known/acme-challenge/` directly in the top level directory ("web root") where your site lives. 

The DNS challenge is more flexible (and is in fact the only type of challenge that allows you to obtain *wildcard* certificates), but it requires you to have an automated way to change DNS records. To avoid making assumptions about your DNS provider, **this example code uses the HTTP challenge**.

## Running This Code

You'll need to have Docker installed, as well as the Alibaba Cloud command line tools `fun` and `fcli`. Docker is needed for `fun install` which will help us build a custom Function Compute runtime that includes `certbot`.

Once you have everything installed, getting set up is relatively easy.

### Modify The Code

### Modify template.yml

### Run `fun install`

### Run `fun deploy`

### Use `fcli` to do a dry run

## Other Notes

